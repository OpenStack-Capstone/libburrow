////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//  PROJECT:  memory backend for libburrow C client API.
//            main public interface.
//
//  AUTHOR:   Federico Saldarini
//  
//  NOTE:     This should be considered a rough sketch at this point.
//  
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "Accounts.c"


typedef enum {READ,DELETE} action_t;

typedef struct
{
  char* messageID;
  char* body;
  burrow_attributes_st* attributes;
} burrow_message;

typedef struct 
{
  accounts_st* accounts;
} burrow_backend_memory;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

burrow_backend_memory* burrow_backend_memory_init(burrow_backend_memory* this)
{
  this->accounts = malloc(sizeof(accounts_st));
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_delete_accounts(burrow_backend_memory* this, burrow_filters_st* filters)
{
  delete(this->accounts, filters);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

accounts_st* burrow_backend_memory_get_accounts(burrow_backend_memory* this, burrow_filters_st* filters)
{
  return iter(this->accounts, filters);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_delete_queues(burrow_backend_memory* this, char* account_key, burrow_filters_st* filters)
{
  accounts_delete_queues(this->accounts, account_key, filters);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

accounts_st* burrow_backend_memory_get_queues(burrow_backend_memory* this, char* account_key, burrow_filters_st* filters)
{
  return iter((get(this->accounts, account_key))->value, filters);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_get_messages(burrow_backend_memory* this, char* account_key, char* queue_key, burrow_filters_st* filters)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_update_messages(burrow_backend_memory* this, char* account_key, char* queue_key, burrow_attributes_st* attributes, burrow_filters_st* filters)
{  
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_create_message(burrow_backend_memory* this, char* account_key, char* queue_key, char* message, char* body, burrow_attributes_st* attributes)
{
  
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_get_message(burrow_backend_memory* this, char* account_key, char* queue_key, char* message)
{
  
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_update_message(burrow_backend_memory* this, char* account_key, char* queue_key, char* message, burrow_attributes_st* attributes)
{
  
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void burrow_backend_memory_clean(burrow_backend_memory* this)
{
  
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

dictionary_st* _scan_queue(burrow_backend_memory* this, char* account_key, char* queue_key, burrow_filters_st* filters, burrow_attributes_st* attributes, action_t action)
{
  queue_st* queue = accounts_get_queue(this->accounts, account_key, queue_key);
  if(queue == NULL)
    return NULL;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

dictionary_st* burrow_backend_memory_delete_messages(burrow_backend_memory* this, char* account_key, char* queue_key, burrow_filters_st* filters)
{
  return _scan_queue(this, account_key, queue_key, filters, NULL, DELETE);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////